#include "stm32g4xx.h"

void EXTI15_10_IRQHandler(void);
void Delay(void);

int main()
{
    __disable_irq();

    // ENABLE GPIOA & GPIOC
    RCC->AHB2ENR |= RCC_AHB2ENR_GPIOAEN | RCC_AHB2ENR_GPIOCEN;
    RCC->APB2ENR |= RCC_APB2ENR_SYSCFGEN;

    // SET PA5 AS OUTPUT PIN
    GPIOA->MODER |= GPIO_MODER_MODE5_0;

    // SET PC13 AS INPUT PIN
    GPIOC->MODER &= ~(GPIO_MODER_MODE13_Msk);

    SYSCFG->EXTICR[3] |= SYSCFG_EXTICR4_EXTI13_PC;

    EXTI->IMR1 |= EXTI_IMR1_IM13;
    EXTI->FTSR1 |= EXTI_FTSR1_FT13;

    NVIC_EnableIRQ(EXTI15_10_IRQn);

    __enable_irq();

    while (1)
    {
        // Your main code can go here if needed
    }
}

void EXTI15_10_IRQHandler(void)
{
    if (EXTI->PR1 & EXTI_PR1_PIF13)
    {
        GPIOA->ODR ^= GPIO_ODR_OD5;
        Delay();
        EXTI->PR1 = EXTI_PR1_PIF13;
    }
}

void Delay(void)
{
    for (volatile int i = 0; i < 100000; i++)
    {
        // Adjust the delay as needed
    }
}
